version: 2

models:
  - name: roku_prod_identifies_stage
    description: See roku_prod sources
  - name: roku_prod_launch_stage 
    description: Launch events tracked via segment on roku prod; when the application opens "cold", not from the background
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
      - name: anonymous_id 
        description: '{{ doc("anonymous_id") }}'
        tests:
          - not_null
      - name: context_ip
        description: '{{ doc("context_ip") }}'
      - name: context_campaign_source 
        description: '{{ doc("context_campaign_source") }}'
      - name: context_campaign_name 
        description: '{{ doc("context_campaign_name") }}'
      - name: context_term 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_medium 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_page_referrer 
        description: '{{ doc("context_page_referrer") }}'
      - name: context_user_agent 
        description: '{{ doc("context_user_agent") }}'
      - name: context_page_path 
        description: '{{ doc("context_page_path") }}'
      - name: context_campaign_content 
        description: '{{ doc("context_campaign_content") }}'
      - name: context_campaign_content_id 
        description: '{{ doc("context_campaign_content_id") }}'
      - name: url 
      #description: not sure what url gets passed here -EM
      - name: visited_at
        description: timestamp indicating when the user launched the app   
        tests:
          - not_null
      - name: coupon_code 
      #description: not sure -EM
      - name: visit_type
        tests:
          - accepted_values:
              values: ['roku']
      - name: has_fast_account_request
        description: boolean value indicating whether or not the app launched because of a deeplink to FAST content
      - name: priority
        tests:
          - accepted_values:
              values: [1, 2]
          - not_null
  - name: roku_prod_player_state_changed_boundaries_stage
    description: Player state changed records annotated with boundary flags and validation attributes
    columns:
      - name: event_id
        description: Segment generated event id
      - name: user_id
        description: >
          {{ doc("user_id") }}
          The user (profile) that watched this asset.
      - name: playback_session_id
        description: '{{ doc("playback_session_id") }}'
      - name: asset_id
        description: '{{ doc("asset_id") }}'
      - name: received_at
        description: '{{ doc("received_at") }}'
      - name: timestamp
        description: '{{ doc("timestamp") }}'
      - name: delay
        description: >
          The number of seconds the user is watching behind live; this should be
          null when the asset is not live.
      - name: hashed_session_id
        description: '{{ doc("hashed_session_id") }}'
      - name: context_ip
        description: '{{ doc("context_ip") }}'
      - name: bitrate
        description: Always null as derived tables did not send this information.
      - name: loaded_at
        description: '{{ doc("loaded_at") }}'
      - name: position_start
        description: '{{ doc("position_start") }}'
      - name: position_stop
        description: '{{ doc("position_stop") }}'
      - name: action
        description: Player action for this event (start, stop, sync)
      - name: position_duration_seconds
        description: The elapsed duration from the playback positions
      - name: watched_range_timestamp_duration_seconds
        description: The elapsed duration from the timestamps of the start and end of this range
      - name: is_starting_event
        description: Indicator for the starting event of a watched range
      - name: is_ending_event
        description: Indicator for the ending event of a watched range
      - name: previous_action
        description: The action for the previous event in this range
      - name: previous_timestamp
        description: The timestamp for the previous event in this range
      - name: next_action
        description: The action for the next event in this range
      - name: next_timestamp
        description: The timestamp for the next event in this range
      - name: watched_range_start_at
        description: Client timestamp for the first event in this range
      - name: watched_range_end_at
        description: Client timestamp for the last event in this range      
      - name: has_reporting_delay
        description: Did this event come more than 310 seconds after the last event?
      - name: has_position_start_jump
        description: Is this position start different than the previous value by more than 10 seconds?
      - name: has_position_stop_jump
        description: Is this position stop more than 310 seconds after the last position stop event?
      - name: played_asset_reporting_delay_count
        description: The number of events in this range with a reporting delay
      - name: played_asset_position_start_jump_count
        description: The number of events in this range with a start jump
      - name: played_asset_position_stop_jump_count
        description: The number of events in this range with a stop jump      
      - name: played_asset_total_event_count
        description: The total number of events in this range
      - name: dbt_processed_at 
        description: '{{ doc("dbt_processed_at") }}'
  - name: roku_prod_player_state_changed_stage
    description: See roku_prod sources
  - name: roku_prod_poll_submit_stage
    description: Answers to to a Philo in-app poll
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
      - name: user_id
        description: '{{ doc("user_id") }}'
      - name: poll_name
        description: The name of the Philo poll answered
      - name: question
        description: The question that was displayed to the user
      - name: answer
        description: The poll answer selected
      - name: environment_analytics_version
        description: Analytics version which indicates what possible answers were available
      - name: received_at
        description: '{{ doc("received_at") }}'
      - name: loaded_at
        description: '{{ doc("loaded_at") }}'
  - name: roku_prod_notifications_stage
    description: message notification events from roku
    columns:
      - name: message_id
      - name: loaded_at
        tests:
          - not_null:
              severity: error
      - name: event_timestamp
        description: time of event set by client's internal clock 
        tests:
          - not_null:
              severity: error
      - name: dbt_processed_at
        description: '{{ doc("dbt_processed_at") }}'
        tests:
          - not_null:
              severity: error
      - name: user_id
        description: '{{ doc("user_id") }}'
        tests:
          - not_null:
              severity: error
      - name: message_external_id
        description: internally set message id (set on the backend and sent to segment)
      - name: message_channel
        description: channel the notification is delivered through
        tests:
          - not_null:
              severity: warn
      - name: received_at
        description: '{{ doc("received_at") }}'
      - name: message_event
        description: The type of message event that was recorded
        tests:
          - not_null:
              severity: error
  - name: roku_prod_browse_while_watching_activated_stage
    description: captures when browse while watching is activated 
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
      - name: user_id
        description: '{{ doc("user_id") }}'
      - name: received_at
        description: '{{ doc("received_at") }}'
      - name: position_ms
        description: what second the video playback is on
      - name: original_timestamp
        description: When the identify event occurred according to roku down to the millisecond
      - name: anonymous_id
        description: Segment generated anonymous id
      - name: environment_analytics_version
        description: Analytics version 
      - name: event
        description: description of event that is triggered 
      - name: environment_screen_width
        description: width of device's screen in pixels
      - name: environment_screen_height
        description: height of device's screen in pixels
      - name: timestamp
        description: When the identify event occurred according to roku
      - name: loaded_at
        description: '{{ doc("loaded_at") }}'
      - name: playback_session_id
        description: unique id for a playback session 
      - name: sent_at
        description: when the event was sent to segment according to roku 
      - name: asset_id
        description: unique id assigned to an asset
      - name: hashed_session_id
        description: ID that tracks a user session which can last an indefinite amount of time. Each time a user signs in they get a new hashed_session_id.
      - name: asset_type
        description: type of asset being watched 
  - name: roku_prod_browse_while_watching_deactivated_stage
    description: captures when browse while watching is activated 
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
      - name: user_id
        description: '{{ doc("user_id") }}'
      - name: received_at
        description: '{{ doc("received_at") }}'
      - name: position_ms
        description: what second the video playback is on
      - name: original_timestamp
        description: When the identify event occurred according to roku down to the millisecond
      - name: anonymous_id
        description: Segment generated anonymous id
      - name: environment_analytics_version
        description: Analytics version 
      - name: event
        description: description of event that is triggered 
      - name: environment_screen_width
        description: width of device's screen in pixels
      - name: environment_screen_height
        description: height of device's screen in pixels
      - name: timestamp
        description: When the identify event occurred according to roku
      - name: loaded_at
        description: '{{ doc("loaded_at") }}'
      - name: playback_session_id
        description: unique id for a playback session 
      - name: sent_at
        description: when the event was sent to segment according to roku 
      - name: asset_id
        description: unique id assigned to an asset
      - name: hashed_session_id
        description: ID that tracks a user session which can last an indefinite amount of time. Each time a user signs in they get a new hashed_session_id.
      - name: asset_type
        description: type of asset being watched
  - name: roku_prod_time_to_stream_start
    description: Counts the number of seconds between an app being launched and the first stream start
    columns: 
      - name: user_id
        description: '{{ doc("user_id") }}'
      - name: platform
        description: Platform on which this stream was played
      - name: open_date
        description: the date on which the app was opened
      - name: open_time
        description: time when the app was opened
      - name: time_to_stream_start
        description: seconds from app launch to first stream start
  - name: roku_prod_watched_ranges_stage
    description: Continuous ranges of watching an asset
    columns:
      - name: event_id
        description: Segment generated event id
      - name: user_id
        description: >
          {{ doc("user_id") }}
          The user (profile) that watched this asset.
      - name: playback_session_id
        description: '{{ doc("playback_session_id") }}'
      - name: asset_id
        description: '{{ doc("asset_id") }}'
      - name: requested_asset_id
        description: '{{ doc("asset_id") }}'
      - name: played_asset_id
        description: '{{ doc("asset_id") }}'
      - name: received_at
        description: '{{ doc("received_at") }}'
      - name: timestamp_start
        description: The timestamp, from the client, the user first started watching the range.
      - name: timestamp
        description: The timestamp, from the client, indicating the end of the watched range.
      - name: delay
        description: >
          The number of seconds the user is watching behind live; this should be
          null when the asset is not live.
      - name: hashed_session_id
        description: '{{ doc("hashed_session_id") }}'
      - name: context_ip
        description: '{{ doc("context_ip") }}'
      - name: bitrate
        description: Always null as derived tables did not send this information.
      - name: loaded_at
        description: '{{ doc("loaded_at") }}'
      - name: position_start
        description: '{{ doc("position_start") }}'
      - name: position_stop
        description: '{{ doc("position_stop") }}'
      - name: action
        description: Player action that ended the event range
      - name: position_duration_seconds
        description: The elapsed duration from the playback positions
      - name: watched_range_timestamp_duration_seconds
        description: The elapsed duration from the timestamps of the start and end of this range
      - name: watched_seconds
        description: The minimum of position changes and timestamp differences
      - name: dbt_processed_at 
        description: '{{ doc("dbt_processed_at") }}'

  - name: roku_prod_launch_paid_stage
    description: Roku app launch; when the application opened "cold", not from the background, for a regular (non-FAST) user
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
      - name: anonymous_id 
        description: '{{ doc("anonymous_id") }}'
      - name: context_ip
        description: '{{ doc("context_ip") }}'
      - name: context_campaign_source 
        description: '{{ doc("context_campaign_source") }}'
      - name: context_campaign_name 
        description: '{{ doc("context_campaign_name") }}'
      - name: context_term 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_medium 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_page_referrer 
        description: '{{ doc("context_page_referrer") }}'
      - name: context_user_agent 
        description: '{{ doc("context_user_agent") }}'
      - name: context_page_path 
        description: '{{ doc("context_page_path") }}'
      - name: context_campaign_content 
        description: '{{ doc("context_campaign_content") }}'
      - name: context_campaign_content_id 
        description: '{{ doc("context_campaign_content_id") }}'
      - name: url 
      #description: not sure what url gets passed here -EM
      - name: visited_at 
        description: timestamp indicating when the user launched the app   
      - name: coupon_code 
      #description: not sure -EM
      - name: visit_type 
      #description: not sure -EM
      - name: has_fast_account_request
        description: boolean value indicating whether or not the app launched because of a deeplink to FAST content
        tests:
          - accepted_values:
              # EM: do we need to account for potential null values here?
              values: ['false']
      - name: priority
        tests:
          - accepted_values:
              values: [1, 2]
  - name: roku_prod_launch_fast_stage
    description: Roku app launch; when the application opened "cold", not from the background, for a FAST only user
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
      - name: anonymous_id 
        description: '{{ doc("anonymous_id") }}'
      - name: context_ip
        description: '{{ doc("context_ip") }}'
      - name: context_campaign_source 
        description: '{{ doc("context_campaign_source") }}'
      - name: context_campaign_name 
        description: '{{ doc("context_campaign_name") }}'
      - name: context_term 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_medium 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_page_referrer 
        description: '{{ doc("context_page_referrer") }}'
      - name: context_user_agent 
        description: '{{ doc("context_user_agent") }}'
      - name: context_page_path 
        description: '{{ doc("context_page_path") }}'
      - name: context_campaign_content 
        description: '{{ doc("context_campaign_content") }}'
      - name: context_campaign_content_id 
        description: '{{ doc("context_campaign_content_id") }}'
      - name: url 
      #description: not sure what url gets passed here -EM
      - name: visited_at 
        description: timestamp indicating when the user launched the app   
      - name: coupon_code 
      #description: not sure -EM
      - name: visit_type 
      #description: not sure -EM
      - name: has_fast_account_request
        description: boolean value indicating whether or not the app launched because of a deeplink to FAST content
        tests:
          - accepted_values:
              values: ['true']
      - name: priority
        tests:
          - accepted_values:
              values: [1, 2]
  - name: roku_prod_application_opened_fast_stage 
    description: Application events tracked via segment on roku prod; when the application opens from the background for FAST only users
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
      - name: anonymous_id 
        description: '{{ doc("anonymous_id") }}'
        tests:
          - not_null
      - name: user_id 
        description: '{{ doc("user_id") }}'
      - name: source
      - name: url 
      #description: not sure what url gets passed here -EM
      - name: visited_at
        description: timestamp indicating when the user launched the app   
        tests:
          - not_null
      - name: coupon_code 
      #description: not sure -EM
      - name: reference
      - name: context_campaign_content_id 
        description: '{{ doc("context_campaign_content_id") }}'
      - name: context_page_referrer 
        description: '{{ doc("context_page_referrer") }}'
      - name: context_user_agent 
        description: '{{ doc("context_user_agent") }}'
      - name: context_page_path 
        description: '{{ doc("context_page_path") }}'
      - name: context_campaign_source 
        description: '{{ doc("context_campaign_source") }}'
      - name: context_campaign_name 
        description: '{{ doc("context_campaign_name") }}'
      - name: context_campaign_term 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_campaign_medium 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_campaign_content 
        description: '{{ doc("context_campaign_content") }}'
      - name: has_fast_account_request
        description: boolean value indicating whether or not the app launched because of a deeplink to FAST content
        tests:
          - accepted_values:
              values: ['true']
      - name: context_ip
        description: '{{ doc("context_ip") }}'
      - name: visit_type
        tests:
          - accepted_values:
              values: ['roku']
      - name: priority
        tests:
          - accepted_values:
              values: [1, 2]
          - not_null
  - name: roku_prod_application_opened_paid_stage 
    description: Application events tracked via segment on roku prod; when the application opens from the background
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
      - name: anonymous_id 
        description: '{{ doc("anonymous_id") }}'
      - name: user_id 
        description: '{{ doc("user_id") }}'
      - name: source
      - name: url 
      #description: not sure what url gets passed here -EM
      - name: visited_at
        description: timestamp indicating when the user launched the app   
      - name: coupon_code 
      #description: not sure -EM
      - name: reference
      - name: context_campaign_content_id 
        description: '{{ doc("context_campaign_content_id") }}'
      - name: context_page_referrer 
        description: '{{ doc("context_page_referrer") }}'
      - name: context_user_agent 
        description: '{{ doc("context_user_agent") }}'
      - name: context_page_path 
        description: '{{ doc("context_page_path") }}'
      - name: context_campaign_source 
        description: '{{ doc("context_campaign_source") }}'
      - name: context_campaign_name 
        description: '{{ doc("context_campaign_name") }}'
      - name: context_campaign_term 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_campaign_medium 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_campaign_content 
        description: '{{ doc("context_campaign_content") }}'
      - name: has_fast_account_request
        description: boolean value indicating whether or not the app launched because of a deeplink to FAST content
      - name: context_ip
        description: '{{ doc("context_ip") }}'
      - name: visit_type
      - name: priority
  - name: roku_prod_application_opened_stage 
    description: Application events tracked via segment on roku prod; when the application opens from the background
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
      - name: anonymous_id 
        description: '{{ doc("anonymous_id") }}'
        tests:
          - not_null
      - name: user_id 
        description: '{{ doc("user_id") }}'
      - name: source
      - name: url 
      #description: not sure what url gets passed here -EM
      - name: visited_at
        description: timestamp indicating when the user opened the app   
        tests:
          - not_null
      - name: coupon_code 
      #description: not sure -EM
      - name: reference
      - name: context_campaign_content_id 
        description: '{{ doc("context_campaign_content_id") }}'
      - name: context_page_referrer 
        description: '{{ doc("context_page_referrer") }}'
      - name: context_user_agent 
        description: '{{ doc("context_user_agent") }}'
      - name: context_page_path 
        description: '{{ doc("context_page_path") }}'
      - name: context_campaign_source 
        description: '{{ doc("context_campaign_source") }}'
      - name: context_campaign_name 
        description: '{{ doc("context_campaign_name") }}'
      - name: context_campaign_term 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_campaign_medium 
      #description: not sure what to add here, see note in segment_docs.md -EM
      - name: context_campaign_content 
        description: '{{ doc("context_campaign_content") }}'
      - name: has_fast_account_request
        description: boolean value indicating whether or not the app launched because of a deeplink to FAST content
      - name: context_ip
        description: '{{ doc("context_ip") }}'
      - name: visit_type
        tests:
          - accepted_values:
              values: ['roku']
      - name: priority
        tests:
          - accepted_values:
              values: [1, 2]
          - not_null